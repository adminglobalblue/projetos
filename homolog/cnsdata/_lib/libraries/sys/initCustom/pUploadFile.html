<!--<div id="up1" class="uploadFile"><div class="dragdrop"></div></div>-->
<style>
.uploadFile .dragdrop {
	border:2px dotted #0B85A1;
	width:auto;
	color:#92AAB0;
	text-align:left;vertical-align:middle;
	padding:10px 10px 10 10px;
	margin-bottom:10px;
	font-size:200%;
	text-align:center;
	height: 65px;
}
.uploadFile label {
	display:block;
	width:100%;
	height:100%;
	cursor: pointer;
	font-size: 26px;
}
.statusbar {
    border-top:1px solid #A9CCD1;
    min-height:25px;
    width: auto;
    padding:10px 10px 0px 10px;
    vertical-align:top;
}
.statusbar div{
    display:inline-block;
	vertical-align:middle;
}
.statusbar .progressBar {
    width: 220px;
    height: 16px;
    overflow: hidden;
    display:inline-block;
    margin:0px 10px 5px 5px;
    vertical-align:middle;
	text-align: left;
    color: #000000;
    font-weight: bold;
} 
.statusbar .progressBar div {
    height: 100%;
    color: #fff;
    text-align: center;
    line-height: 16px; /* same as #progressBar height if we want text middle aligned */
    width: 0;
	background-color: #09ab28;
	position: relative;
}
.statusbar .progressBar span {
	display: inline;
	float: right;
}
.statusbar .filename {
	width:250px;
}
.statusbar .filesize {
	color:#30693D;
	width:100px;
	margin-left:10px;
	margin-right:5px;
}
.statusbar .abort {
    background-color:#A8352F;
    -moz-border-radius:4px;
    -webkit-border-radius:4px;
    border-radius:4px;display:inline-block;
    color:#fff;
    font-family:arial;font-size:13px;font-weight:normal;
    padding:4px 15px;
    cursor:pointer;
}
</style>
	
<script>
uploadFile = {
	url:'http://localhost:81/teste/t1?teste=t',
	dragDropStr:'Arraste, solte e ',
	uploadStr:'Carregar',
	btnClass:'btn btn-primary',
	btnStyle:'',
	labelStyle:'',
	autoUpload:false,
	rowCount:0,
	onSuccess:null,
	onError:null,
	onSysError:null,
	onServerError:null,
	onComplete:null,
	extraData:null, 
	onSysSuccess:null,
	files: {},
	formData:null,
	init:function(e){
		var obj = $('#'+e);
		var ddObj = $('#'+e+' .dragdrop');
		var id = e+"fileinput";
		inputFile = $("<label for='"+id+"' style='"+uploadFile.labelStyle+"'>"+uploadFile.dragDropStr+"</label><input multiple type='file' id='"+id+"' style='display:none'>").appendTo(ddObj);
		uploadBtn = !uploadFile.autoUpload ? $('<button style="'+uploadFile.btnStyle+'" class="'+uploadFile.btnClass+'">'+uploadFile.uploadStr+'</button>').appendTo('label[for='+id+']') : null;
		ddObj.on('dragenter', function (e) {
			e.stopPropagation();e.preventDefault();
			$(this).css('border', '2px solid #0B85A1');
		});
		ddObj.on('dragover', function (e) {
			 e.stopPropagation();e.preventDefault();
		});
		ddObj.on('drop', function (e) {
			$(this).css('border', '2px dotted #0B85A1');
			e.preventDefault();
			uploadFile.files = $.merge($.merge([],uploadFile.files),e.originalEvent.dataTransfer.files)
			uploadFile.mountStatus(obj);
			if(uploadFile.autoUpload) {
				uploadFile.handleFileUpload(obj);
			}
		});
		$(document).on('dragenter', function (e) {
			e.stopPropagation();e.preventDefault();
		});
		$(document).on('dragover', function (e) {
			e.stopPropagation();e.preventDefault();
		});
		$(document).on('drop', function (e) {
			e.stopPropagation();e.preventDefault();
		});
		
		inputFile.on('change', function (e) {
			uploadFile.files = $.merge($.merge([],uploadFile.files),$(e.target).prop('files'));			
			uploadFile.mountStatus(obj);
			if(uploadFile.autoUpload) {uploadFile.handleFileUpload(obj)};
		});
		uploadBtn.on('click', function (e){
			e.stopPropagation();e.preventDefault();
			uploadFile.handleFileUpload(obj);
		});
	},
	validateFile:function(file) {
		return true;
	},
	mountStatus:function(obj) {
		for (var i = 0; i < uploadFile.files.length; i++) {
			console.log(uploadFile.files[i]);
			if (!uploadFile.files[i].mountStatus && !uploadFile.files[i].uploaded) {
				uploadFile.files[i].status = new uploadFile.createStatusbar(obj, i); //Using this we can set progress.
				uploadFile.files[i].status.setFileNameSize(uploadFile.files[i].name,uploadFile.files[i].size);
				uploadFile.files[i].status.setRemove();
				uploadFile.files[i].mountStatus = true;
			}
		}
	},
	handleFileUpload:function (obj) {
		for (var i = 0; i < uploadFile.files.length; i++) {
			if (!uploadFile.files[i].uploaded) {
				uploadFile.formData = new FormData();
				uploadFile.formData.append('file', uploadFile.files[i]);
				uploadFile.sendFileToServer(uploadFile.formData, uploadFile.files[i].status);
			}
		}
	},
	createStatusbar:function (obj, i) {
		uploadFile.rowCount++;
		var row="odd";
		if(uploadFile.rowCount %2 ==0) row ="even";
		this.index = i;
		this.bar = $("<div class='statusbar "+row+"'></div>");
		this.filename = $("<div class='filename'></div>").appendTo(this.bar);
		this.size = $("<div class='filesize'></div>").appendTo(this.bar);
		this.progressBar = $("<div class='progressBar'><div></div><span></span></div>").appendTo(this.bar);
		this.abort = $("<div class='abort' data-remove='"+i+"'>Remover</div>").appendTo(this.bar);
		this.status = $("<div class='status'></div>").appendTo(this.bar);
		this.statusbar = $(this.bar).appendTo(obj);
		this.setFileNameSize = function(name,size) {
			var sizeStr="";
			var sizeKB = size/1024;
			if(parseInt(sizeKB) > 1024) {
				var sizeMB = sizeKB/1024;
				sizeStr = sizeMB.toFixed(2)+" MB";
			}
			else {
				sizeStr = sizeKB.toFixed(2)+" KB";
			}
	 
			this.filename.html(name);
			this.size.html(sizeStr);
		}
		this.setProgress = function(progress) {       
			var progressBarWidth =progress*170/ 100;  
			this.progressBar.find('div').animate({ width: progressBarWidth }, 10)
			this.progressBar.find('span').html(progress + "% ");
			if(parseInt(progress) >= 100) {
				this.abort.hide();
				uploadFile.files[this.index].uploaded = true;
			}
		}
		this.setRemove = function(){
			var sb = this.statusbar;
			var i = this.index;
			this.abort.click(function() {
				sb.hide();
				uploadFile.files[i].uploaded = true;
			});
		}
		this.setAbort = function(jqxhr){
			var sb = this.statusbar;
			this.abort.click(function() {
				jqxhr.abort();
				sb.hide();
				uploadFile.files[this.index].uploaded = true;
			});
		}
		this.setStatus = function(msg) {
			this.status.html(msg);
		}
		
		
	},
	sendFileToServer:function(formData,status){
		var uploadURL = uploadFile.url; //Upload URL
		if(uploadFile.extraData) formData.append('data', uploadFile.extraData);
		var jqXHR=$.ajax({
				xhr: function() {
				var xhrobj = $.ajaxSettings.xhr();
				if (xhrobj.upload) {
						xhrobj.upload.addEventListener('progress', function(event) {
							var percent = 0;
							var position = event.loaded || event.position;
							var total = event.total;
							if (event.lengthComputable) {
								percent = Math.ceil(position / total * 100);
							}
							//Set progress
							status.setProgress(percent);
						}, false);
					}
				return xhrobj;
			},
		url: uploadURL,
		type: "POST",
		contentType:false,
		processData: false,
		cache: false,
		data: formData,
		success: function(data){
			status.setProgress(100);
			if (uploadFile.onSuccess) uploadFile.onSuccess(data);
			if (typeof data.data != 'undefined' && typeof data.data.status != 'undefined') {
				if (data.data.status) {
					if (uploadFile.onSysSuccess) uploadFile.onSysSuccess(data);
				} else {
					if (uploadFile.onSysError) uploadFile.onSysError(data);
				}
			} else {
				if (uploadFile.onServerError) uploadFile.onServerError(data);
			}
			status.setStatus("File upload Done");
			console.log(data);
		},
		error:function(data){
			if (uploadFile.onError) uploadFile.onError(data);
		},
		complete: function (data) {
			if (uploadFile.onComplete) uploadFile.onComplete(data);
		}
	}); 
		status.setAbort(jqXHR);
	}
};

</script>